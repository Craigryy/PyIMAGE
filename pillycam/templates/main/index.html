{% extends "account/base.html" %}
{% load static %}

{% block content %}

<div class="column">
    {% include "main/navbar.html" %}
</div>

<div class="dashboard-container">
    <!-- Include your board content here -->
    {% include "main/board.html" %}
    <br/>
    <br/>
    
    <h1>Image Effects</h1>

    <!-- Form for image upload -->
    <form id="uploadForm" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="file" name="image" accept="image/*" required>
        <select name="effect">
            <option value="brightness">Brightness</option>
            <option value="grayscale">Grayscale</option>
            <option value="blackwhite">Black & White</option>
            <option value="sepia">Sepia</option>
            <option value="contrast">Contrast</option>
            <option value="blur">Blur</option>
            <option value="findedges">Find Edges</option>
            <option value="bigenhance">Edge Enhance (More)</option>
            <option value="enhance">Edge Enhance</option>
            <option value="smooth">Smooth (More)</option>
            <option value="emboss">Emboss</option>
            <option value="contour">Contour</option>
            <option value="sharpen">Sharpen</option>
            <!-- Add more effect options as needed -->
        </select>
        <button type="button" id="applyEffect">Apply Effect</button>
        <button type="submit">Upload and Save</button>
    </form>

    <!-- Display the uploaded and processed image -->
    <div id="imageContainer">
        <!-- <h2>Uploaded Image</h2>
        <img id="uploadedImage" alt="Uploaded Image">
         -->
        <h2>Processed Image</h2>
        <img id="processedImage" alt="Processed Image">
    </div>

    <!-- Delete buttons for the uploaded images -->
    {% for image in images %}
        <button class="delete-button" data-image-id="{{ image.id }}">Delete Image {{ image.id }}</button>
    {% endfor %}
</div>

<!-- Include the Facebook SDK script -->
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v10.0&appId=YOUR_APP_ID&autoLogAppEvents=1" nonce="YOUR_RANDOM_NONCE"></script>

<script>
    // Function to apply image effect
    $("#applyEffect").click(function () {
        var selectedEffect = $("select[name='effect']").val();

        $.get({
            url: "{% url 'main:image' %}",  // Use the correct URL name
            data: {
                effect: selectedEffect,
                image_path: $("#uploadedImage").attr("src")
            },
            success: function (data) {
                // Display the processed image
                $("#processedImage").attr("src", data);
            },
            error: function () {
                alert("Error applying effect.");
            }
        });
    });

    // Function to upload and save the image
    $("#uploadForm").submit(function (e) {
        e.preventDefault();

        $.ajax({
            url: "{% url 'main:home' %}",  // Use the correct URL name
            type: "post",
            data: new FormData(this),
            processData: false,
            contentType: false,
            success: function (data) {
                // Display the uploaded image
                $("#uploadedImage").attr("src", data);
                // Clear the processed image
                $("#processedImage").attr("src", "");
            },
            error: function () {
                alert("Error uploading image.");
            }
        });
    });

    // Function to delete the image
    $(".delete-button").click(function () {
        var imageId = $(this).data("image-id");

        $.ajax({
            url: "{% url 'main:delete' id=0 %}".replace('0', imageId),  // Use the correct URL name
            type: "get",
            success: function () {
                // Refresh the page or update the UI as needed
                location.reload();
            },
            error: function () {
                alert("Error deleting image.");
            }
        });
    });
</script>

{% endblock %}
